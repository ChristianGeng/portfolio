function prompter_agstop
% function prompter_agstop

AG=prompter_gagd;

if ~AG.usesybox
    quietflag=1;
    timeout=prompter_getemaall(quietflag);
    AG=prompter_gagd;
    if AG.active
        try
            togglestatus;
            %                togglestatus_noconnect(s);
        catch
            prompter_writelogfile(['prompter_agstop: Error with togglestatus?' crlf]);
            disp(lasterr);
            disp('Stop recording by hand, if still running');
            keyboard;
        end;
    end;
    
else
    
    
    A=AG.Alines;
    statbuf=AG.statbuf;
    agstat=statbuf(1,:);
    
    %Only do togglestatus if AG500 not already stopped
    
    if ~agstat(A.sweep)
        try
            togglestatus;
            %                togglestatus_noconnect(s);
        catch
            prompter_writelogfile(['prompter_agstop: Error with togglestatus?' crlf]);
            disp(lasterr);
            disp('Stop recording by hand, if still running');
            keyboard;
        end;
    end;
    
    
end;
