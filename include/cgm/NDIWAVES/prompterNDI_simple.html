<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of prompterNDI_simple</title>
  <meta name="keywords" content="prompterNDI_simple">
  <meta name="description" content="VERSION USING BUILT IN AUDIO CAPTURE">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">NDIWAVES</a> &gt; prompterNDI_simple.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for NDIWAVES&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>prompterNDI_simple
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>VERSION USING BUILT IN AUDIO CAPTURE</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function prompterNDI_simple(stimfile,logfile,trial_duration,fontsize,startwav,endwav,mysynchline); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> VERSION USING BUILT IN AUDIO CAPTURE
 PROMPTER_PARALLEL Prompt program with synch signal output on parallel port. Will also run when port n.a
 function prompter_parallel(stimfile,logfile,trial_duration,fontsize,startwav,endwav,mysynchline);
 prompter_parallel: Version 21.08.11

    Syntax
        fontsize: Size of font for stimulus display to subject. Given in
            normalized units
        trial_duration: in s. If empty, stop interactively (key press)
        startwav and endwav (optional). WAV files played at start and end, respectively
                could be just a bell, but could also be e.g a synch
                inpulse.
        mysynchline: Optional, default to 8. Specifies the output line of
            the parallel port to use for synch signal.
            Set to 8 if using the additional connection on the special box used
            at Munich to connect the parallel port input to the AG500 and the output to the VTG55
            video timer.
            Set to 1 if using a cable like that used for synch output from Phil's version
            of the AG100 software

   Description
       Outputs synch signal to parallel port at start of trial.
       Simple version of prompter_parallel_trigin, without video timer
       control and monitoring of AG500 status
       This version can be used when daq toolbox access to parallel port
       not available.
       Thus also useful for testing integrity of prompt files before
       experiment because it can be run when parallel port in not
       accessible (this requires administrator privileges on Windows XP
       It is intended that this program will eventually be merged with
       prompter_parallel_trigin etc.
        See prompter_parallel_trigin or prompter_parallel_trigag for more
        up-to-date help.
       Note: unlike prompter_parallel_trigin etc. this version has no code
       for optional handling of vt220 serial terminal

   See Also PROMPTER_PARALLEL_TRIGIN, PROMPTER_PARALLEL_TRIGAG

    Updates
        10.10 synchline made configurable. 'comment' command works as in
        prompter_parallel_trigin etc.
       08.11 Add userstart/stop functions (see source code for details)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="wave_connect.html" class="code" title="function [s] = wave_connect (timeoutin)">wave_connect</a>	WAVE_CONNECT --- establish socket connection to NDI RT Server</li><li><a href="wave_negPackage.html" class="code" title="function [p] = wave_negPackage (s,q,averbose)">wave_negPackage</a>	WAVE_NEGPACKAGE - negotiate NDI wave packages with the NDI RT server.</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">functionname=</a></li><li><a href="#_sub2" class="code">function showg(ht,mys);</a></li><li><a href="#_sub3" class="code">function updatefigs</a></li><li><a href="#_sub4" class="code">function dotrafficlights(tlcol,ht,figh);</a></li><li><a href="#_sub5" class="code">function showhelp</a></li></ul>
<h2><a name="_download"></a>DOWNLOAD <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<p><a href="prompterNDI_simple.m">prompterNDI_simple.m</a></p>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function prompterNDI_simple(stimfile,logfile,trial_duration,fontsize,startwav,endwav,mysynchline);</a>
0002 <span class="comment">% VERSION USING BUILT IN AUDIO CAPTURE</span>
0003 <span class="comment">% PROMPTER_PARALLEL Prompt program with synch signal output on parallel port. Will also run when port n.a</span>
0004 <span class="comment">% function prompter_parallel(stimfile,logfile,trial_duration,fontsize,startwav,endwav,mysynchline);</span>
0005 <span class="comment">% prompter_parallel: Version 21.08.11</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%    Syntax</span>
0008 <span class="comment">%        fontsize: Size of font for stimulus display to subject. Given in</span>
0009 <span class="comment">%            normalized units</span>
0010 <span class="comment">%        trial_duration: in s. If empty, stop interactively (key press)</span>
0011 <span class="comment">%        startwav and endwav (optional). WAV files played at start and end, respectively</span>
0012 <span class="comment">%                could be just a bell, but could also be e.g a synch</span>
0013 <span class="comment">%                inpulse.</span>
0014 <span class="comment">%        mysynchline: Optional, default to 8. Specifies the output line of</span>
0015 <span class="comment">%            the parallel port to use for synch signal.</span>
0016 <span class="comment">%            Set to 8 if using the additional connection on the special box used</span>
0017 <span class="comment">%            at Munich to connect the parallel port input to the AG500 and the output to the VTG55</span>
0018 <span class="comment">%            video timer.</span>
0019 <span class="comment">%            Set to 1 if using a cable like that used for synch output from Phil's version</span>
0020 <span class="comment">%            of the AG100 software</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%   Description</span>
0023 <span class="comment">%       Outputs synch signal to parallel port at start of trial.</span>
0024 <span class="comment">%       Simple version of prompter_parallel_trigin, without video timer</span>
0025 <span class="comment">%       control and monitoring of AG500 status</span>
0026 <span class="comment">%       This version can be used when daq toolbox access to parallel port</span>
0027 <span class="comment">%       not available.</span>
0028 <span class="comment">%       Thus also useful for testing integrity of prompt files before</span>
0029 <span class="comment">%       experiment because it can be run when parallel port in not</span>
0030 <span class="comment">%       accessible (this requires administrator privileges on Windows XP</span>
0031 <span class="comment">%       It is intended that this program will eventually be merged with</span>
0032 <span class="comment">%       prompter_parallel_trigin etc.</span>
0033 <span class="comment">%        See prompter_parallel_trigin or prompter_parallel_trigag for more</span>
0034 <span class="comment">%        up-to-date help.</span>
0035 <span class="comment">%       Note: unlike prompter_parallel_trigin etc. this version has no code</span>
0036 <span class="comment">%       for optional handling of vt220 serial terminal</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%   See Also PROMPTER_PARALLEL_TRIGIN, PROMPTER_PARALLEL_TRIGAG</span>
0039 <span class="comment">%</span>
0040 <span class="comment">%    Updates</span>
0041 <span class="comment">%        10.10 synchline made configurable. 'comment' command works as in</span>
0042 <span class="comment">%        prompter_parallel_trigin etc.</span>
0043 <span class="comment">%       08.11 Add userstart/stop functions (see source code for details)</span>
0044 
0045 <a name="_sub1" href="#_subfunctions" class="code">functionname=</a><span class="string">'PROMPTER_PARALLEL: Version 21.08.2011'</span>;
0046 
0047 philcom(1)
0048 imageprefix=<span class="string">'&lt;IMAGE&gt;'</span>;
0049 
0050 synchline=8;        <span class="comment">%compatible with vtgctrl (otherwise use 1)</span>
0051 <span class="comment">%synchline=1;</span>
0052 
0053 <span class="keyword">if</span> nargin&gt;6
0054     synchline=mysynchline;
0055 <span class="keyword">end</span>;
0056 
0057 
0058 wavlist=[];
0059 wavlistsynch=0;        <span class="comment">%12.09</span>
0060 
0061 <span class="comment">% Prepare connection to the NDI device:</span>
0062 [s] = <a href="wave_connect.html" class="code" title="function [s] = wave_connect (timeoutin)">wave_connect</a>(2900)
0063 <span class="comment">%s.getSoTimeout</span>
0064 
0065 q.data=<span class="string">'Version 1.0'</span>;
0066 q.type=1;
0067 p = <a href="wave_negPackage.html" class="code" title="function [p] = wave_negPackage (s,q,averbose)">wave_negPackage</a> (s,q);
0068 disp(char(p.data'))
0069 
0070 <span class="comment">% cString = 'SetByteOrder LittleEndian' 'false'</span>
0071 q.data=<span class="string">'SetByteOrder LittleEndian'</span>;
0072 q.type=1;
0073 p = <a href="wave_negPackage.html" class="code" title="function [p] = wave_negPackage (s,q,averbose)">wave_negPackage</a> (s,q);
0074 
0075 disp(char(p.data'))
0076 
0077 qStart=assembleStartRecordingPacket;
0078 qStop=assembleStartRecordingPacket(0);
0079 
0080 
0081 <span class="comment">%matlab commands, or script or function file, to be executed at start and</span>
0082 <span class="comment">%end of trial (i.e the string specified here is passed to the eval</span>
0083 <span class="comment">%function)</span>
0084 <span class="comment">%Using a function is preferable, to reduce chances of inadvertently</span>
0085 <span class="comment">%changing program variables</span>
0086 <span class="comment">%This mechanism could be used as an alternative way of handling audio</span>
0087 <span class="comment">%output depending on current stimulus. Should mainly be useful for</span>
0088 <span class="comment">%modifying the prompt display in various ways.</span>
0089 <span class="comment">%could also be used to enforce a minimum 'getready' duration.</span>
0090 
0091 userstopfunc=<span class="string">''</span>; <span class="comment">%called at end of trial, just before new stimulus is displayed (so e.g could be used to make</span>
0092 <span class="comment">%stimulus invisible until the next 'next' command</span>
0093 userstartfunc=<span class="string">''</span>; <span class="comment">%called during the next command, before start of trial. Specifically, after any audio</span>
0094 <span class="comment">%output specified in wavlist has been done.</span>
0095 <span class="comment">% In prompter_parallel_trigag it is called before the signal to the AG500</span>
0096 <span class="comment">% control server to start the trial</span>
0097 <span class="comment">% In prompter_parallel_trigin it is called before the program waits for the</span>
0098 <span class="comment">% attention signal.</span>
0099 <span class="comment">% Future versions for ag500 control may include separate functions linked</span>
0100 <span class="comment">% to the attention and sweep signals</span>
0101 
0102 
0103 
0104 
0105 daqok=1;
0106 <span class="keyword">try</span>
0107     parport = digitalio(<span class="string">'parallel'</span>,<span class="string">'LPT1'</span>);
0108     lines_OUT_1 = addline(parport,[0:7],0,<span class="string">'out'</span>);
0109     
0110     putvalue(parport.Line(synchline),0);
0111 <span class="keyword">catch</span>
0112     disp(<span class="string">'parallel port not available, try logging in as administrator'</span>);
0113     daqok=0;
0114 <span class="keyword">end</span>;
0115 
0116 
0117 [abint,abnoint,abscalar,abnoscalar]=abartdef;
0118 
0119 wavstart=[];
0120 <span class="keyword">if</span> nargin&gt;4
0121     wavstart=startwav;
0122     <span class="keyword">if</span> ~isempty(wavstart)
0123         [wavstart_d,wavstart_sf,wavstart_bits]=wavread(wavstart);
0124     <span class="keyword">end</span>;
0125 <span class="keyword">end</span>;
0126 
0127 
0128 
0129 wavend=[];
0130 <span class="keyword">if</span> nargin&gt;5
0131     wavend=endwav;
0132     
0133     <span class="keyword">if</span> ~isempty(wavend)
0134         [wavend_d,wavend_sf,wavend_bits]=wavread(wavstart);
0135     <span class="keyword">end</span>;
0136     
0137     
0138     
0139     
0140 <span class="keyword">end</span>;
0141 
0142 <span class="comment">%if true, program continues without waiting for end of sound</span>
0143 wavstart_async=0;
0144 wavend_async=0;
0145 
0146 [ps,cs,s1line,nstim,nline,prepareimage,maxcol]=parsestimfile(stimfile);
0147 
0148 helpwin prompter_parallel;
0149 
0150 helpwin(s1line,stimfile);
0151 
0152 
0153 fid=fopen(logfile,<span class="string">'w'</span>);
0154 <span class="keyword">if</span> fid&lt;3
0155     disp(<span class="string">'unable to open log file'</span>);
0156     <span class="keyword">return</span>
0157 <span class="keyword">end</span>;
0158 ts=[<span class="string">'&lt;'</span> <a name="_sub2" href="#_subfunctions" class="code">functionname </a><span class="string">'&gt;'</span> crlf];
0159 status=fwrite(fid,ts,<span class="string">'uchar'</span>);
0160 <span class="keyword">if</span> status~=length(ts)
0161     disp(<span class="string">'Problem writing to log file'</span>);
0162     fclose(fid);
0163     <span class="keyword">return</span>;
0164 <span class="keyword">end</span>;
0165 
0166 
0167 hfsub=figure;
0168 set(hfsub,<span class="string">'color'</span>,<span class="string">'w'</span>);
0169 set(hfsub,<span class="string">'menu'</span>,<span class="string">'none'</span>);
0170 haxp=axes;
0171 xlim([0 1]);
0172 ylim([0 1]);
0173 set(gca,<span class="string">'visible'</span>,<span class="string">'off'</span>);
0174 set(gca,<span class="string">'position'</span>,[0.05 0.05 0.9 0.9]);
0175 
0176 ht=text(0.5,0.5,<span class="string">'***'</span>,<span class="string">'horizontalalignment'</span>,<span class="string">'left'</span>,<span class="string">'verticalalignment'</span>,<span class="string">'middle'</span>);
0177 set(ht,<span class="string">'fontunits'</span>,<span class="string">'normalized'</span>,<span class="string">'fontsize'</span>,fontsize,<span class="string">'userdata'</span>,fontsize,<span class="string">'tag'</span>,<span class="string">'prompt'</span>);
0178 
0179 set(ht,<span class="string">'edgecolor'</span>,<span class="string">'r'</span>,<span class="string">'linewidth'</span>,5,<span class="string">'margin'</span>,15);
0180 
0181 haxsub=gca;
0182 set(hfsub,<span class="string">'name'</span>,<span class="string">'Subject'</span>);
0183 
0184 haxi=[];
0185 <span class="comment">%vi=strmatch(imageprefix,ps);</span>
0186 <span class="comment">%if ~isempty(vi)</span>
0187 <span class="keyword">if</span> prepareimage
0188     disp(<span class="string">'preparing for image data'</span>);
0189     haxi=axes;
0190     set(haxi,<span class="string">'position'</span>,get(haxp,<span class="string">'position'</span>));
0191     set(haxi,<span class="string">'tag'</span>,imageprefix);
0192     hi=image;
0193     set(hi,<span class="string">'tag'</span>,imageprefix);
0194     <span class="comment">%make sure axis ticks and labels are not visible when axes is visible</span>
0195     <span class="comment">%but see note below</span>
0196     set(haxi,<span class="string">'ycolor'</span>,get(hfsub,<span class="string">'color'</span>),<span class="string">'xcolor'</span>,get(hfsub,<span class="string">'color'</span>));
0197     <span class="comment">%7.10 use axes rather than figure color to cue the subject</span>
0198     set(haxi,<span class="string">'color'</span>,<span class="string">'r'</span>,<span class="string">'linewidth'</span>,10);
0199     set(haxi,<span class="string">'visible'</span>,<span class="string">'off'</span>);
0200     set(hi,<span class="string">'visible'</span>,<span class="string">'on'</span>);
0201     
0202     disp(<span class="string">'load image data'</span>);
0203     <span class="comment">%the loading script could show one image to allow size to be checked</span>
0204     <span class="comment">%and should then normally set axis image or axis equal (not sure</span>
0205     <span class="comment">%what happens with axis image if image size varies)</span>
0206     <span class="comment">%But for the normal case of same-size images then axis image is better.</span>
0207     <span class="comment">%(axis equal will leave additional strips in the axis color with size</span>
0208     <span class="comment">%depending on precise image dimensions, - and also little notches in the</span>
0209     <span class="comment">%background color at the tick location (can be fixed with e.g</span>
0210     <span class="comment">%set(haxi,'xtick',[]);</span>
0211     <span class="comment">%example for the loading script:</span>
0212     <span class="comment">%===========================</span>
0213     <span class="comment">%set(haxi,'userdata',mymatin('mca6_medgem_images','data'));</span>
0214     
0215     <span class="comment">%assume monochrome image (not stored as truecolor)</span>
0216     <span class="comment">%if data still stored as logical use this:</span>
0217     <span class="comment">%set(get(haxi,'parent'),'colormap',gray(2));</span>
0218     <span class="comment">%otherwise if resized and antialiased, use this:</span>
0219     <span class="comment">%set(get(haxi,'parent'),'colormap',gray(256));</span>
0220     <span class="comment">%tmpxx=get(haxi,'userdata');</span>
0221     <span class="comment">%tmpxx=tmpxx{1};</span>
0222     <span class="comment">%set(hi,'cdata',tmpxx);</span>
0223     <span class="comment">%axis(haxi,'image');</span>
0224     <span class="comment">%clear tmpxx;</span>
0225     <span class="comment">%===============================</span>
0226     
0227     keyboard;
0228     set(hi,<span class="string">'visible'</span>,<span class="string">'off'</span>);
0229     
0230 <span class="keyword">end</span>;
0231 
0232 hfinv=[];
0233     hfinv=figure;
0234     set(hfinv,<span class="string">'color'</span>,get(hfsub,<span class="string">'color'</span>));
0235     set(hfinv,<span class="string">'menu'</span>,<span class="string">'none'</span>);
0236     set(hfinv,<span class="string">'colormap'</span>,get(hfsub,<span class="string">'colormap'</span>));    <span class="comment">%ensure colormaps are same, especially for image mode</span>
0237     
0238     copyobj([haxsub haxi],hfinv);
0239     ht(2)=findobj(hfinv,<span class="string">'type'</span>,<span class="string">'text'</span>,<span class="string">'tag'</span>,<span class="string">'prompt'</span>);
0240     set(hfinv,<span class="string">'name'</span>,<span class="string">'Investigator'</span>);
0241     <span class="comment">%show trial number and current time in investigator prompt window</span>
0242     <span class="comment">%make axes a bit smaller to give room for text above</span>
0243     haxinv=findobj(hfinv,<span class="string">'type'</span>,<span class="string">'axes'</span>);
0244     mypos=get(haxinv(1),<span class="string">'position'</span>);
0245     mypos(1:2)=[0.05 0.01];
0246     mynewsize=mypos(3:4)*0.85;        <span class="comment">%factor will depend on how many lines of text</span>
0247     mypos(3:4)=mynewsize;
0248     set(haxinv,<span class="string">'position'</span>,mypos);
0249     htinfo(1)=text(0,1.12+0.02,<span class="string">' '</span>,<span class="string">'fontweight'</span>,<span class="string">'bold'</span>,<span class="string">'fontunits'</span>,<span class="string">'normalized'</span>,<span class="string">'verticalalignment'</span>,<span class="string">'bottom'</span>);
0250     htinfo(2)=text(0,1.02,<span class="string">' '</span>,<span class="string">'fontweight'</span>,<span class="string">'bold'</span>,<span class="string">'fontunits'</span>,<span class="string">'normalized'</span>,<span class="string">'verticalalignment'</span>,<span class="string">'bottom'</span>,<span class="string">'interpreter'</span>,<span class="string">'none'</span>);
0251     set(htinfo,<span class="string">'fontsize'</span>,0.1,<span class="string">'erasemode'</span>,<span class="string">'xor'</span>);
0252     set(hfinv,<span class="string">'doublebuffer'</span>,<span class="string">'on'</span>);
0253     
0254     <span class="comment">%could be used to indicate stopped/running if normal traffic lights are not</span>
0255     <span class="comment">%used for this (or if not visible on video)</span>
0256     htinforuncol=<span class="string">'k'</span>;
0257     htinfostopcol=<span class="string">'k'</span>;
0258     
0259 
0260 figh=[hfsub hfinv];
0261 
0262 
0263 P.figurebasecolor=get(hfsub,<span class="string">'color'</span>);
0264 P.promptmode=<span class="string">'text'</span>;
0265 P.imageprefix=imageprefix;
0266 set(hfsub,<span class="string">'userdata'</span>,P);
0267 
0268 
0269 <span class="comment">%colors for signal to subject</span>
0270 <span class="comment">%normal colours</span>
0271 TL.stop=[1 0 0];
0272 TL.go=[0.1 0.8 0.1];
0273 TL.getready=[1 1 0];
0274 
0275 <span class="comment">%no change in colours</span>
0276 <span class="comment">%TL.stop=[0 0 0];</span>
0277 <span class="comment">%TL.go=[0 0 0];</span>
0278 <span class="comment">%TL.getready=[0 0 0];</span>
0279 
0280 
0281 
0282 
0283 <span class="comment">%can also adjust text properties, traffic light colours  etc. by hand</span>
0284 <span class="comment">%can also adjust text properties, traffic light colours etc. by hand</span>
0285 disp(<span class="string">'Position Subject, Investigator and Help figures, then type return'</span>);
0286 disp(<span class="string">'(Optionally adjust other settings)'</span>);
0287 keyboard;
0288 
0289 <a href="#_sub4" class="code" title="subfunction dotrafficlights(tlcol,ht,figh);">dotrafficlights</a>(TL.stop,ht,figh);
0290 
0291 drawnow;
0292 <a href="#_sub3" class="code" title="subfunction updatefigs">updatefigs</a>;
0293 <span class="comment">%set(gcf,'menu','none')</span>
0294 
0295 all_done=0;
0296 irun=1;
0297 <a href="#_sub5" class="code" title="subfunction showhelp">showhelp</a>;
0298 
0299 <span class="keyword">while</span> ~all_done
0300     ts=datestr(now);
0301     ts=[<span class="string">'&lt;Start of Sequence&gt; '</span> ts crlf];
0302     status=fwrite(fid,ts,<span class="string">'uchar'</span>);
0303     <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,<span class="string">'\fontname{Helvetica}!New Sequence!'</span>);
0304     <span class="comment">%   showg(ht,str2mat('!new!','!sequence!'));</span>
0305     disp(<span class="string">'Starting prompt sequence'</span>);
0306     disp(<span class="string">'hit any key to continue'</span>);
0307     pause;
0308     
0309     istim=1;
0310     repeatstr=<span class="string">''</span>;
0311     rubbishstr=<span class="string">''</span>;
0312     <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,ps{istim});
0313     <span class="comment">%   set(ht,'color','r');</span>
0314     
0315     <a href="#_sub4" class="code" title="subfunction dotrafficlights(tlcol,ht,figh);">dotrafficlights</a>(TL.stop,ht,figh);
0316     
0317     <span class="comment">%set(ht,'edgecolor','r');</span>
0318     <a href="#_sub3" class="code" title="subfunction updatefigs">updatefigs</a>;
0319     disp(ps{istim});
0320     disp([<span class="string">'&lt;CODE&gt; '</span> cs{istim}]);
0321     set(htinfo(2),<span class="string">'string'</span>,[int2str(istim) <span class="string">' : '</span> cs{istim}]);
0322     finished=0;
0323     freecomment=<span class="string">'%['</span>;
0324     
0325     <span class="keyword">while</span> ~finished
0326         mycmd=abartstr(<span class="string">'Command: '</span>,<span class="string">'n'</span>);
0327         <span class="comment">%      mycmd=lower(mycmd);</span>
0328         <span class="keyword">if</span> mycmd==<span class="string">'h'</span> <a href="#_sub5" class="code" title="subfunction showhelp">showhelp</a>; <span class="keyword">end</span>;
0329         
0330         <span class="keyword">if</span> mycmd==<span class="string">'n'</span>
0331             <a href="#_sub4" class="code" title="subfunction dotrafficlights(tlcol,ht,figh);">dotrafficlights</a>(TL.getready,ht,figh);
0332             
0333             drawnow;
0334             
0335             <span class="comment">%use mysound????, what about scaling????</span>
0336             <span class="comment">%audio output from list here</span>
0337             <span class="keyword">if</span> ~isempty(wavlist)
0338                 <span class="keyword">try</span>
0339                     tmpname=deblank(wavlist(istim,:));
0340                     [audioprompt,audiopromptsf]=wavread(tmpname);
0341                     sound(audioprompt,audiopromptsf,16);
0342                     <span class="keyword">if</span> wavlistsynch pause(length(audioprompt)/audiopromptsf); <span class="keyword">end</span>;
0343                     
0344                 <span class="keyword">catch</span>
0345                     disp(<span class="string">'problem playing audio'</span>);
0346                 <span class="keyword">end</span>;
0347             <span class="keyword">end</span>;
0348             
0349             <span class="keyword">if</span> ~isempty(userstartfunc)
0350                 eval(userstartfunc,<span class="string">'disp(''Error evaluating userstartfunc'');disp(lasterr)'</span>);
0351             <span class="keyword">end</span>;
0352             
0353             
0354             <span class="comment">%finish off last comment</span>
0355             status=fwrite(fid,[rubbishstr freecomment <span class="string">']'</span> crlf],<span class="string">'uchar'</span>);
0356             freecomment=<span class="string">''</span>;
0357             rubbishstr=<span class="string">''</span>;
0358             
0359             iruns=int2str(irun);
0360             set(htinfo(1),<span class="string">'string'</span>,iruns,<span class="string">'color'</span>,htinfostopcol);
0361             drawnow;
0362             sx=int2str([irun istim]);
0363             
0364             
0365             
0366             <span class="keyword">if</span> ~isempty(wavstart)
0367                 soundsc(wavstart_d,wavstart_sf,wavstart_bits);
0368                 <span class="keyword">if</span> ~wavstart_async
0369                     tmppause=length(wavstart_d)/wavstart_sf;
0370                     pause(tmppause);
0371                 <span class="keyword">end</span>;
0372             <span class="keyword">end</span>;
0373             
0374             disp([<span class="string">'Recording '</span> int2str([irun istim])]);
0375             
0376             
0377             <span class="comment">% Start Recording</span>
0378             <span class="comment">%con=pnet('tcpconnect','localhost',12345)</span>
0379             
0380                         
0381             pause(0.1)
0382             <span class="comment">% Start the NDI System:</span>
0383             p = <a href="wave_negPackage.html" class="code" title="function [p] = wave_negPackage (s,q,averbose)">wave_negPackage</a> (s,qStart);
0384 
0385             
0386             mytime=now;
0387             <span class="comment">%         set(ht,'color',[0.1 0.8 0.1]);</span>
0388             <span class="comment">%         set(ht,'edgecolor','g');</span>
0389             <a href="#_sub4" class="code" title="subfunction dotrafficlights(tlcol,ht,figh);">dotrafficlights</a>(TL.go,ht,figh);
0390             
0391             drawnow;
0392             <a href="#_sub3" class="code" title="subfunction updatefigs">updatefigs</a>;
0393             tic;
0394             <span class="keyword">if</span> daqok putvalue(parport.Line(synchline),1); <span class="keyword">end</span>;
0395             set(htinfo(1),<span class="string">'color'</span>,htinforuncol);
0396             drawnow;
0397             <span class="keyword">if</span> isempty(trial_duration)
0398                 pause
0399             <span class="keyword">else</span>
0400                 <span class="keyword">while</span> toc&lt;trial_duration
0401                     <span class="comment">%                pause(trial_duration);</span>
0402                     pause(0.015);       <span class="comment">%no point in updating any faster</span>
0403                     set(htinfo(1),<span class="string">'string'</span>,[iruns <span class="string">' : '</span> num2str(toc,<span class="string">'%4.3f'</span>)]);
0404                     drawnow;
0405                 <span class="keyword">end</span>;
0406                 
0407             <span class="keyword">end</span>;
0408             <span class="comment">%use mysound????, what about scaling????</span>
0409             <span class="keyword">if</span> daqok putvalue(parport.Line(synchline),0); <span class="keyword">end</span>;
0410             set(htinfo(1),<span class="string">'string'</span>,[iruns <span class="string">' : '</span> num2str(toc,<span class="string">'%4.3f'</span>)],<span class="string">'color'</span>,htinfostopcol);
0411             
0412             <span class="keyword">if</span> ~isempty(wavend)
0413                 soundsc(wavend_d,wavend_sf,wavend_bits);
0414                 <span class="keyword">if</span> ~wavend_async
0415                     tmppause=length(wavend_d)/wavend_sf;
0416                     pause(tmppause);
0417                 <span class="keyword">end</span>;
0418             <span class="keyword">end</span>;
0419             
0420             mytoc=toc;
0421             
0422             disp(<span class="string">'Stopped'</span>);
0423             
0424             
0425             <span class="comment">% Stoppen:</span>
0426             <span class="comment">%pnet('closeall')</span>
0427             p = <a href="wave_negPackage.html" class="code" title="function [p] = wave_negPackage (s,q,averbose)">wave_negPackage</a> (s,qStop);
0428             
0429             [dodo,mytime]=strtok(datestr(mytime));
0430             sx=[sx <span class="string">' '</span> mytime];
0431             sx=[sx <span class="string">' '</span> num2str(mytoc)];
0432             
0433             <span class="keyword">if</span> ~isempty(userstopfunc)
0434                 eval(userstopfunc,<span class="string">'disp(''Error evaluating userstopfunc'');disp(lasterr)'</span>);
0435             <span class="keyword">end</span>;
0436             
0437             <span class="keyword">if</span> istim&lt;nstim
0438                 <span class="comment">%display new stimulus immediately to subject</span>
0439                 <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,ps{istim+1});
0440                 set(htinfo(2),<span class="string">'string'</span>,[int2str(istim+1) <span class="string">' : '</span> cs{istim+1}]);
0441                 
0442                 <span class="comment">%            set(ht,'color','r');</span>
0443                 <span class="comment">%            set(ht,'edgecolor','r');</span>
0444                 <a href="#_sub4" class="code" title="subfunction dotrafficlights(tlcol,ht,figh);">dotrafficlights</a>(TL.stop,ht,figh);
0445                 drawnow;
0446                 <a href="#_sub3" class="code" title="subfunction updatefigs">updatefigs</a>;
0447                 
0448             <span class="keyword">end</span>;
0449             
0450             
0451             
0452             <span class="comment">%10.03 free comment now has to be entered with explicit command</span>
0453             
0454             mycomm=[<span class="string">' ['</span> cs{istim} repeatstr ];
0455             repeatstr=<span class="string">''</span>;
0456             <span class="comment">%write trial number and time of day</span>
0457             sx=[sx mycomm];
0458             status=fwrite(fid,sx,<span class="string">'uchar'</span>);
0459             
0460             
0461             
0462             
0463             
0464             
0465             
0466             irun=irun+1;
0467             istim=istim+1;
0468             
0469             <span class="keyword">if</span> istim&lt;=nstim
0470                 disp(ps{istim});
0471                 disp([<span class="string">'&lt;CODE&gt; '</span> cs{istim}]);
0472             <span class="keyword">else</span>
0473                 disp(<span class="string">'End of stimuli'</span>);
0474                 finished=1;
0475                 <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,<span class="string">'\fontname{Helvetica}!!END!!'</span>);
0476                 set(htinfo(2),<span class="string">'string'</span>,<span class="string">''</span>);
0477                 <span class="comment">%finish off last comment</span>
0478                 status=fwrite(fid,[freecomment <span class="string">']'</span> crlf],<span class="string">'uchar'</span>);
0479                 freecomment=<span class="string">''</span>;
0480                 
0481             <span class="keyword">end</span>;
0482             
0483             
0484         <span class="keyword">end</span>;            <span class="comment">%next</span>
0485         <span class="keyword">if</span> mycmd==<span class="string">'c'</span>
0486             
0487             freecomment=philinp(<span class="string">'Comment : '</span>);
0488             freecomment=[<span class="string">'_'</span> freecomment];
0489             
0490         <span class="keyword">end</span>;
0491         
0492         
0493         <span class="keyword">if</span> mycmd==<span class="string">'q'</span>
0494             finished=1;
0495             <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,<span class="string">'\fontname{Helvetica}!!END!!'</span>);
0496             set(htinfo(2),<span class="string">'string'</span>,<span class="string">''</span>);
0497             <span class="comment">%finish off last comment</span>
0498             status=fwrite(fid,[freecomment <span class="string">']'</span> crlf],<span class="string">'uchar'</span>);
0499             freecomment=<span class="string">''</span>;
0500             s.close;
0501             clear s;
0502             
0503         <span class="keyword">end</span>;
0504         <span class="keyword">if</span> mycmd==<span class="string">'k'</span>
0505             keyboard;
0506         <span class="keyword">end</span>;
0507         
0508         <span class="keyword">if</span> ((mycmd==<span class="string">'r'</span>) | (mycmd==<span class="string">'R'</span>))
0509             disp(<span class="string">'Repeating!!'</span>);
0510             repeatstr=<span class="string">'!!Repeat!!'</span>;
0511             rubbishstr=<span class="string">'!!Rubbish!!'</span>;   <span class="comment">%as comment is not closed until next &quot;next&quot; command this marks the trial with the problem</span>
0512             
0513             istim=istim-1;
0514             <span class="keyword">if</span> mycmd==<span class="string">'R'</span>
0515                 irun=irun-1;
0516                 disp(<span class="string">'Re-using previous trial number'</span>);
0517             <span class="keyword">end</span>;
0518             <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,<span class="string">'\fontname{Helvetica}!Repeat!'</span>);
0519             
0520             disp(<span class="string">'hit any key to continue'</span>);
0521             pause
0522             <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,ps{istim});
0523             <a href="#_sub4" class="code" title="subfunction dotrafficlights(tlcol,ht,figh);">dotrafficlights</a>(TL.stop,ht,figh);
0524             disp(ps{istim});
0525             disp([<span class="string">'&lt;CODE&gt; '</span> cs{istim}]);
0526             set(htinfo(2),<span class="string">'string'</span>,[int2str(istim) <span class="string">' : '</span> cs{istim}]);
0527             
0528         <span class="keyword">end</span>;
0529         
0530         <span class="keyword">if</span> mycmd==<span class="string">'g'</span>
0531             istim=abart(<span class="string">'New stimulus number'</span>,istim,1,nstim,abint,abscalar);
0532             <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,<span class="string">'\fontname{Helvetica}!Change of Stimulus!'</span>);
0533             rubbishstr=[<span class="string">'!!Stimulus number changed to '</span> int2str(istim) <span class="string">' !!'</span>];
0534             repeatstr=<span class="string">'!!May be first of several repeats!!'</span>;
0535             
0536             disp(<span class="string">'hit any key to continue'</span>);
0537             pause
0538             <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,ps{istim});
0539             <a href="#_sub4" class="code" title="subfunction dotrafficlights(tlcol,ht,figh);">dotrafficlights</a>(TL.stop,ht,figh);
0540             disp(ps{istim});
0541             disp([<span class="string">'&lt;CODE&gt; '</span> cs{istim}]);
0542             set(htinfo(2),<span class="string">'string'</span>,[int2str(istim) <span class="string">' : '</span> cs{istim}]);
0543             
0544         <span class="keyword">end</span>;
0545         
0546         <span class="keyword">if</span> mycmd==<span class="string">'m'</span>
0547             set(ht,<span class="string">'visible'</span>,<span class="string">'off'</span>);
0548             mymess=philinp(<span class="string">'Enter message to subject '</span>);
0549             mymess=rv2strm(mymess,crlf);
0550             <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,mymess);
0551             set(ht,<span class="string">'visible'</span>,<span class="string">'on'</span>,<span class="string">'edgecolor'</span>,<span class="string">'m'</span>);
0552             
0553         <span class="keyword">end</span>;
0554         <span class="keyword">if</span> mycmd==<span class="string">'M'</span>
0555             set(ht,<span class="string">'visible'</span>,<span class="string">'off'</span>);
0556             mymess=philinp(<span class="string">'Enter message to subject '</span>);
0557             mymess=rv2strm(mymess,crlf);
0558             <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,mymess);
0559             set(ht,<span class="string">'visible'</span>,<span class="string">'on'</span>,<span class="string">'edgecolor'</span>,<span class="string">'m'</span>);
0560             disp(<span class="string">'hit any key to continue'</span>);
0561             pause
0562             <a href="#_sub2" class="code" title="subfunction showg(ht,mys);">showg</a>(ht,ps{istim});
0563             <a href="#_sub4" class="code" title="subfunction dotrafficlights(tlcol,ht,figh);">dotrafficlights</a>(TL.stop,ht,figh);
0564             
0565             <span class="comment">%   set(ht,'edgecolor','r');</span>
0566             disp(ps{istim});
0567             disp([<span class="string">'&lt;CODE&gt; '</span> cs{istim}]);
0568             
0569         <span class="keyword">end</span>;
0570         <span class="keyword">if</span> mycmd==<span class="string">'d'</span>
0571             disp(<span class="string">'Enter new trial duration'</span>);
0572             trial_duration=abart(<span class="string">'New duration'</span>,trial_duration,1,999,abnoint,abscalar);
0573             status=fwrite(fid,[<span class="string">'&lt;Trial Duration changed to '</span> num2str(trial_duration) <span class="string">'&gt;'</span> crlf],<span class="string">'uchar'</span>);
0574         <span class="keyword">end</span>;
0575         
0576     <span class="keyword">end</span>;
0577     mystr=abartstr(<span class="string">'Terminate ? '</span>,<span class="string">'y'</span>);
0578     mystr=lower(mystr);
0579     
0580     <span class="keyword">if</span> mystr~=<span class="string">'n'</span> all_done=1; <span class="keyword">end</span>;
0581 <span class="keyword">end</span>;
0582 
0583 status=fclose(fid);
0584 
0585 disp(<span class="string">'hit any key to exit program'</span>);
0586 pause;
0587 hfinv=findobj(<span class="string">'type'</span>,<span class="string">'figure'</span>,<span class="string">'name'</span>,<span class="string">'Investigator'</span>);
0588 delete([hfsub;hfinv]);
0589 <span class="keyword">if</span> daqok
0590     delete(parport);
0591     clear parport;
0592 <span class="keyword">end</span>;
0593 
0594 
0595 
0596 
0597 <a name="_sub3" href="#_subfunctions" class="code">function showg(ht,mys);</a>
0598 <span class="comment">%note: other version have third input argument to flag vt220 control</span>
0599 <span class="comment">%08.11 only automatically turn visibility on at end if current visibility</span>
0600 <span class="comment">%is on</span>
0601 <span class="comment">%Not yet sure this will work properly if mixing image and text prompts</span>
0602 <span class="comment">%imageprefix='&lt;IMAGE&gt;';</span>
0603 
0604 oldhtvis=get(ht(1),<span class="string">'visible'</span>);      <span class="comment">%if current visibility is 'off' (e.g because of action in userstopfunc, leave off at end)</span>
0605 hfsub=findobj(<span class="string">'type'</span>,<span class="string">'figure'</span>,<span class="string">'name'</span>,<span class="string">'Subject'</span>);
0606 P=get(hfsub,<span class="string">'userdata'</span>);
0607 
0608 hi=findobj(<span class="string">'type'</span>,<span class="string">'image'</span>,<span class="string">'tag'</span>,P.imageprefix);
0609 oldhivis=<span class="string">''</span>;
0610 <span class="keyword">if</span> ~isempty(hi) 
0611     oldhivis=get(hi,<span class="string">'visible'</span>);
0612     set(hi,<span class="string">'visible'</span>,<span class="string">'off'</span>); 
0613 <span class="keyword">end</span>;
0614 hai=findobj(<span class="string">'type'</span>,<span class="string">'axes'</span>,<span class="string">'tag'</span>,P.imageprefix);
0615 
0616 set(ht,<span class="string">'visible'</span>,<span class="string">'off'</span>);
0617 
0618 mysc=char(mys);
0619 <span class="keyword">if</span> findstr(P.imageprefix,mysc(1,:))
0620     
0621     <span class="keyword">if</span> ~isempty(hi)
0622         tmp=strrep(mysc(1,:),P.imageprefix,<span class="string">''</span>);
0623         imnum=str2num(tmp);
0624         <span class="keyword">if</span> ~isempty(imnum)
0625             <span class="keyword">if</span> ~isempty(hai)
0626                 imdata=get(hai(1),<span class="string">'userdata'</span>);
0627                 <span class="keyword">if</span> iscell(imdata)
0628                     imdata=imdata{imnum};
0629                     set(hi,<span class="string">'cdata'</span>,imdata);
0630                     <span class="keyword">if</span> strcmp(oldhivis,<span class="string">'on'</span>)
0631                         set(hi,<span class="string">'visible'</span>,<span class="string">'on'</span>);     <span class="comment">%handle axes visibility the same?</span>
0632                     <span class="keyword">end</span>;
0633                     
0634                     set(hai,<span class="string">'visible'</span>,<span class="string">'on'</span>);
0635                     P.promptmode=<span class="string">'image'</span>;
0636                     set(hfsub,<span class="string">'userdata'</span>,P)
0637                     drawnow;
0638                     <a href="#_sub3" class="code" title="subfunction updatefigs">updatefigs</a>;
0639                     <span class="keyword">return</span>;
0640                 <span class="keyword">end</span>;
0641             <span class="keyword">end</span>;
0642         <span class="keyword">end</span>;
0643     <span class="keyword">end</span>;
0644     
0645 <span class="keyword">end</span>;
0646 
0647 <span class="comment">%if image display not possible, treat as normal text display</span>
0648 
0649 
0650 <span class="comment">%normal text display</span>
0651 
0652 <span class="comment">%turn off axes containing image if last prompt was image</span>
0653 <span class="keyword">if</span> strcmp(P.promptmode,<span class="string">'image'</span>)
0654     set(hai,<span class="string">'visible'</span>,<span class="string">'off'</span>);
0655     <span class="comment">%    hfinv=findobj('type','figure','name','Investigator');</span>
0656     <span class="comment">%    set([hfsub hfinv],'color',P.figurebasecolor);</span>
0657 <span class="keyword">end</span>;
0658 
0659 P.promptmode=<span class="string">'text'</span>;
0660 set(hfsub,<span class="string">'userdata'</span>,P);
0661 
0662 tmpsize=get(ht(1),<span class="string">'userdata'</span>);
0663 set(ht,<span class="string">'fontsize'</span>,tmpsize);
0664 set(ht,<span class="string">'string'</span>,mys);
0665 eee=get(ht(1),<span class="string">'extent'</span>);
0666 ppp=get(ht(1),<span class="string">'position'</span>);
0667 
0668 maxex=max(eee(3:4));
0669 <span class="keyword">if</span> maxex&gt;1
0670     disp(<span class="string">'Reducing font to fit'</span>);
0671     disp(1/maxex);
0672     tmpsize=get(ht(1),<span class="string">'fontsize'</span>)*(1/maxex);
0673     set(ht,<span class="string">'fontsize'</span>,tmpsize);
0674     eee=get(ht(1),<span class="string">'extent'</span>);
0675 <span class="keyword">end</span>;
0676 
0677 
0678 
0679 
0680 xe=eee(3);
0681 <span class="comment">%disp('extent');</span>
0682 <span class="comment">%disp(eee);</span>
0683 
0684 
0685 halign=get(ht(1),<span class="string">'horizontalalignment'</span>);
0686 <span class="keyword">if</span> strcmp(halign,<span class="string">'left'</span>)
0687     ppp(1)=0.5-xe/2;
0688 <span class="keyword">else</span>
0689     ppp(1)=0.5;
0690 <span class="keyword">end</span>;
0691 
0692 
0693 set(ht,<span class="string">'position'</span>,ppp);
0694 
0695 <span class="comment">%disp('position')</span>
0696 <span class="comment">%disp(ppp);</span>
0697 <span class="comment">%disp('axes x/y lim');</span>
0698 <span class="comment">%disp([get(gca,'xlim') get(gca,'ylim')]);</span>
0699 
0700 <span class="keyword">if</span> strcmp(oldhtvis,<span class="string">'on'</span>)
0701     set(ht,<span class="string">'visible'</span>,<span class="string">'on'</span>);
0702 <span class="keyword">end</span>;
0703 
0704 drawnow;
0705 <a href="#_sub3" class="code" title="subfunction updatefigs">updatefigs</a>;
0706 
0707 <a name="_sub4" href="#_subfunctions" class="code">function updatefigs</a>
0708 <span class="keyword">return</span>;    <span class="comment">%disabled</span>
0709 hfi=findobj(<span class="string">'type'</span>,<span class="string">'figure'</span>,<span class="string">'name'</span>,<span class="string">'Investigator'</span>);
0710 
0711 <span class="keyword">if</span> isempty(hfi) <span class="keyword">return</span>; <span class="keyword">end</span>;        <span class="comment">%assume separate figure not needed</span>
0712 
0713 hfs=findobj(<span class="string">'type'</span>,<span class="string">'figure'</span>,<span class="string">'name'</span>,<span class="string">'Subject'</span>);
0714 
0715 ppps=get(hfs,<span class="string">'position'</span>);
0716 pppi=get(hfi,<span class="string">'position'</span>);
0717 
0718 set(hfs,<span class="string">'position'</span>,ppps);    <span class="comment">%must have been a typo here</span>
0719 set(hfi,<span class="string">'position'</span>,pppi);
0720 
0721 <span class="keyword">return</span>;
0722 
0723 figure(hf);
0724 
0725 refresh(hf);
0726 drawnow;
0727 
0728 <span class="comment">%ppos=get(0,'pointerlocation');</span>
0729 <span class="comment">%fpos=get(hf,'position');</span>
0730 <span class="comment">%newpos=ppos;</span>
0731 <span class="comment">%newpos=[fpos(1)+fpos(3)/2 fpos(2)+fpos(4)/2];</span>
0732 <span class="comment">%set(0,'pointerlocation',newpos);</span>
0733 hf=findobj(<span class="string">'type'</span>,<span class="string">'figure'</span>,<span class="string">'name'</span>,<span class="string">'Subject'</span>);
0734 figure(hf);
0735 refresh(hf);
0736 drawnow;
0737 <span class="comment">%set(0,'pointerlocation',ppos);</span>
0738 
0739 <a name="_sub5" href="#_subfunctions" class="code">function dotrafficlights(tlcol,ht,figh);</a>
0740 P=get(figh(1),<span class="string">'userdata'</span>);
0741 
0742 <span class="keyword">if</span> strcmp(P.promptmode,<span class="string">'text'</span>)
0743     oldcol=get(ht(1),<span class="string">'edgecolor'</span>);
0744     <span class="keyword">if</span> any(oldcol~=tlcol) set(ht,<span class="string">'edgecolor'</span>,tlcol); <span class="keyword">end</span>;
0745 <span class="keyword">end</span>;
0746 <span class="keyword">if</span> strcmp(P.promptmode,<span class="string">'image'</span>)
0747     hai=findobj(<span class="string">'type'</span>,<span class="string">'axes'</span>,<span class="string">'tag'</span>,P.imageprefix);
0748     oldcol=get(hai(1),<span class="string">'color'</span>);
0749     <span class="keyword">if</span> any(oldcol~=tlcol) set(hai,<span class="string">'color'</span>,tlcol); <span class="keyword">end</span>;
0750     <span class="comment">%    oldcol=get(figh(1),'color');</span>
0751     <span class="comment">%    if any(oldcol~=tlcol) set(figh,'color',tlcol); end;</span>
0752 <span class="keyword">end</span>;
0753 <a name="_sub6" href="#_subfunctions" class="code">function showhelp</a>
0754 helpstr=str2mat(<span class="keyword">...</span>
0755     <span class="string">'Commands are:'</span>,<span class="keyword">...</span>
0756     <span class="string">'n = next (default)'</span>,<span class="keyword">...</span>
0757     <span class="string">'c = comment'</span>,<span class="keyword">...</span>
0758     <span class="string">'d = set trial duration'</span>,<span class="keyword">...</span>
0759     <span class="string">'r = repeat'</span>,<span class="keyword">...</span>
0760     <span class="string">'R = repeat with old trial number'</span>,<span class="keyword">...</span>
0761     <span class="string">'g = goto'</span>,<span class="keyword">...</span>
0762     <span class="string">'m = message'</span>,<span class="keyword">...</span>
0763     <span class="string">'M = message and resume'</span>,<span class="keyword">...</span>
0764     <span class="string">'q = quit'</span>,<span class="keyword">...</span>
0765     <span class="string">'k = keyboard'</span>,<span class="keyword">...</span>
0766     <span class="string">'h = help'</span>);
0767 disp(helpstr);
0768 helpwin(helpstr,<span class="string">'Prompt commands'</span>);
0769 
0770 <span class="comment">%    'a = autonext',...</span>
0771 <span class="comment">%    't = set trial number',...</span></pre></div>
<hr><address>Generated on Wed 30-Jan-2013 17:04:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>